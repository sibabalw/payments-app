import{r as o,u as U,j as e,H as Y,L as D}from"./app-BRoNAUIM.js";import{A as J,P as K,a as Q,b as ee}from"./app-layout-Bn-75oUf.js";import{B as u,X as se}from"./x-pZV5lkp5.js";import{C as P,a as T,b as k,c as E}from"./card-Bag7gWUQ.js";import{I as q}from"./input-6bP_JhyV.js";import{L as n}from"./label-BAqrWHKw.js";import{S as F,a as A,b as R,c as I,d as p}from"./select-Cv0uEHLH.js";import{D as te,i as L}from"./date-picker-Dnh-dPsy.js";import{C as $}from"./checkbox-DPgHpQ4P.js";import{I as m}from"./input-error-jm3AyEfT.js";import{P as le}from"./plus-C6lF1Clu.js";/* empty css            */import"./app-sidebar-header-BbzcXdQi.js";import"./appearance-dropdown-BEtN_wNg.js";import"./index-CBJSSLbQ.js";import"./index-Cfp_L9w6.js";import"./log-out-MC42nTzo.js";import"./index-BohsM0ZD.js";import"./badge-ZsznMIyW.js";import"./proxy-CQkt3OrQ.js";import"./circle-check-DIHwzO_b.js";import"./loader-circle-CafrvZjs.js";import"./circle-x-C4YAnoMU.js";import"./circle-alert-COfzFcbZ.js";import"./dollar-sign-CDLUu5fH.js";import"./message-square-CEp_sz_O.js";import"./file-text-FWLsz4T5.js";import"./users-CEYKQlp0.js";import"./user-check-DiuzZ-7a.js";import"./clock-DWicTrer.js";import"./shield-Kl3V0fgW.js";import"./index-CfMSX17F.js";import"./check-CU7v0mdS.js";import"./chevron-up-DDm2opro.js";import"./calendar-Bnzdv3WK.js";import"./format-BS8Ay9AX.js";import"./chevron-left-uzkLnT6H.js";import"./calendar-CALmSmzi.js";function Ze({businesses:H,employees:x,selectedBusinessId:W,escrowBalance:y}){const G=(()=>{const s=new Date;if(s.setDate(s.getDate()+1),!L(s)){const t=new Date(s);for(;!L(t);)t.setDate(t.getDate()+1);return t}return s})(),M="09:00",[c,_]=o.useState("all"),[i,f]=o.useState([]),[h,N]=o.useState(""),[w,j]=o.useState([]),[b,C]=o.useState(!1),g=o.useRef(null),{data:l,setData:r,post:Z,processing:V,errors:d}=U({business_id:W||H[0]?.id||"",name:"",schedule_type:"recurring",scheduled_date:G.toISOString().split("T")[0],scheduled_time:M,frequency:"monthly",employee_ids:[]});o.useEffect(()=>{if(g.current&&clearTimeout(g.current),!h.trim()||!l.business_id){j([]);return}g.current=setTimeout(async()=>{C(!0);try{const s=new URLSearchParams({business_id:String(l.business_id),query:h.trim()}),t=await fetch(`/employees/search?${s.toString()}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(t.ok){const a=await t.json();j(a)}}catch(s){console.error("Search error:",s)}finally{C(!1)}},300)},[h,l.business_id]);const X=s=>{if(!i.includes(s.id)){const t=[...i,s.id];f(t),r("employee_ids",t)}N(""),j([])},B=s=>{const t=i.filter(a=>a!==s);f(t),r("employee_ids",t)},O=s=>{if(s.preventDefault(),c==="all"){const t=x?.map(a=>a.id)||[];r("employee_ids",t)}else c==="select"&&r("employee_ids",i);Z("/payroll")};return e.jsxs(J,{breadcrumbs:[{title:"Payroll",href:"/payroll"},{title:"Create",href:"#"}],children:[e.jsx(Y,{title:"Create Payroll Schedule"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:e.jsxs(P,{children:[e.jsx(T,{children:e.jsx(k,{children:"Create Payroll Schedule"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"name",children:"Payroll Name"}),e.jsx(q,{id:"name",value:l.name,onChange:s=>r("name",s.target.value),required:!0}),e.jsx(m,{message:d.name})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"schedule_type",children:"Schedule Type"}),e.jsxs(F,{value:l.schedule_type,onValueChange:s=>r("schedule_type",s),children:[e.jsx(A,{children:e.jsx(R,{})}),e.jsxs(I,{children:[e.jsx(p,{value:"recurring",children:"Recurring Payment"}),e.jsx(p,{value:"one_time",children:"One-time Payment"})]})]}),e.jsx(m,{message:d.schedule_type}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l.schedule_type==="one_time"?"Payment will execute once at the scheduled time and then be cancelled":"Payment will execute repeatedly based on the selected frequency"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Schedule Date & Time"}),e.jsx(te,{date:l.scheduled_date?(()=>{const[s,t,a]=l.scheduled_date.split("-").map(Number),[v,S]=(l.scheduled_time||"00:00").split(":").map(Number);return new Date(s,t-1,a,v,S)})():void 0,onDateChange:s=>{if(s){const t=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),v=String(s.getDate()).padStart(2,"0");r("scheduled_date",`${t}-${a}-${v}`);const S=String(s.getHours()).padStart(2,"0"),z=String(s.getMinutes()).padStart(2,"0");r("scheduled_time",`${S}:${z}`)}},time:l.scheduled_time,onTimeChange:s=>r("scheduled_time",s),showTime:!0}),e.jsx(m,{message:d.scheduled_date}),e.jsx(m,{message:d.scheduled_time}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Weekends and South Africa public holidays are not allowed"})]}),l.schedule_type==="recurring"&&e.jsxs("div",{children:[e.jsx(n,{htmlFor:"frequency",children:"Frequency"}),e.jsxs(F,{value:l.frequency,onValueChange:s=>r("frequency",s),children:[e.jsx(A,{children:e.jsx(R,{})}),e.jsxs(I,{children:[e.jsx(p,{value:"daily",children:"Daily"}),e.jsx(p,{value:"weekly",children:"Weekly"}),e.jsx(p,{value:"monthly",children:"Monthly"})]})]}),e.jsx(m,{message:d.frequency}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[l.frequency==="daily"&&"Payment will execute every day at the selected time",l.frequency==="weekly"&&"Payment will execute every week on the same weekday at the selected time",l.frequency==="monthly"&&"Payment will execute every month on the same day at the selected time"]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Who gets this payroll?"}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"all_employees",checked:c==="all",onCheckedChange:s=>{s&&(_("all"),f([]),r("employee_ids",[]))}}),e.jsx(n,{htmlFor:"all_employees",className:"cursor-pointer font-normal",children:"All Employees"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"select_employees",checked:c==="select",onCheckedChange:s=>{s&&_("select")}}),e.jsx(n,{htmlFor:"select_employees",className:"cursor-pointer font-normal",children:"Select Employees"})]}),e.jsx(m,{message:d.employee_ids})]}),c==="select"&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(n,{children:"Select Employees"}),x.length===0?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["No employees found for this business. ",e.jsx(D,{href:"/employees/create",className:"text-primary underline",children:"Create an employee"})," first."]}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",className:"w-full justify-start",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),b?"Searching...":"Search and add employees"]})}),e.jsxs(ee,{className:"w-80 p-0",align:"start",children:[e.jsx("div",{className:"p-2",children:e.jsx(q,{placeholder:"Search employees...",value:h,onChange:s=>N(s.target.value)})}),e.jsx("div",{className:"max-h-60 overflow-auto",children:w.length>0?e.jsx("div",{className:"p-2 space-y-1",children:w.map(s=>e.jsxs(u,{type:"button",variant:"ghost",className:"w-full justify-start",onClick:()=>X(s),disabled:i.includes(s.id),children:[s.name,s.email&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.email,")"]})]},s.id))}):h&&!b&&e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No employees found"})})]})]}),i.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:i.map(s=>{const t=x?.find(a=>a.id===s);return t?e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Gross: ZAR ",parseFloat(t.gross_salary||0).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>B(s),children:e.jsx(se,{className:"h-4 w-4"})})]},s):null})})]})]})]}),(c==="all"||i.length>0)&&e.jsxs(P,{className:"bg-muted",children:[e.jsx(T,{children:e.jsx(k,{className:"text-lg",children:"Total Payroll Summary"})}),e.jsxs(E,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:c==="all"?`All employees (${x.length} total). Tax calculations will be performed automatically for each employee when the payroll runs.`:`${i.length} employee(s) selected. Tax calculations will be performed automatically for each employee when the payroll runs.`}),y!=null&&e.jsxs("p",{className:"text-sm mt-2",children:["Available Escrow Balance: ",new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR"}).format(y)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"submit",disabled:V,children:"Create Payroll"}),e.jsx(D,{href:"/payroll",children:e.jsx(u,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]})})]})}export{Ze as default};
