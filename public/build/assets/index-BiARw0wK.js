import{c as qe,u as Ge,r as we,j as s,a as $e,H as Ke,L as Qe}from"./app-zh9bNfQA.js";import{C as Te}from"./confirmation-dialog-DD8tonQt.js";import{B as q}from"./createLucideIcon-BZjvJ1Zn.js";import{C as o,c,a,b as m}from"./card-BdZbHl6r.js";import{I as Me}from"./input-DiGHHSH4.js";import{L as ze}from"./label-Bimm6ppi.js";import{I as He}from"./input-error-2-LekhPz.js";import{A as Ue}from"./admin-layout-BWrldFRv.js";import{a as Xe,b as Ye,c as es,S as ss,d as ts}from"./select-Bf_U1fyU.js";import{C as ns}from"./circle-check-big-DpF25LQg.js";import{W as rs}from"./app-sidebar-header-CRr_1DPO.js";import{P as ls}from"./plus-DPynhUc-.js";/* empty css            */import"./dialog-BDMD06yW.js";import"./index-BH508O9j.js";import"./index-Bvd5418W.js";import"./x-BIBjS2Dr.js";import"./index-NEtNT4ix.js";import"./spinner-DI7qxYjB.js";import"./loader-circle-DmMzF6DP.js";import"./info-DszxC6pq.js";import"./triangle-alert-B_NYeNJG.js";import"./index-BJwOBxES.js";import"./appearance-dropdown-Bb28oTQN.js";import"./chevron-down-C7_CWyHS.js";import"./index-CaEI0-fE.js";import"./shield-DgxHpXTb.js";import"./users-DRMz8fhj.js";import"./message-square-CrR61UD7.js";import"./file-text-DIkPgk9X.js";import"./lock-BsRQ3mjQ.js";import"./credit-card-DZtV9Y3R.js";import"./chart-column-S0VcatN5.js";import"./index-CvHCqEC4.js";import"./chevron-right-O9ILxyvV.js";import"./check-BlMOmQr2.js";import"./chevron-up-DTZu2ggr.js";import"./index-CcLcdVZM.js";import"./log-out-D2fYovF8.js";const is=[{title:"Admin",href:"#"},{title:"Escrow Management",href:"/admin/escrow"}];function Us(r){const e=qe.c(119),{pendingDeposits:f,confirmedDeposits:G,businesses:n,escrowAccountNumber:Ve,succeededPayments:K,failedPayments:Q}=r;let U;e[0]===Symbol.for("react.memo_cache_sentinel")?(U={business_id:"",amount:"",currency:"ZAR",bank_reference:""},e[0]=U):U=e[0];const{data:x,setData:l,post:Ce,processing:Re,errors:u}=Ge(U),[ke,Fe]=we.useState(!1),[Ae,De]=we.useState(!1),[d,X]=we.useState(null);we.useState(null);let Y;e[1]!==Ce?(Y=t=>{t.preventDefault(),Ce("/admin/escrow/deposits")},e[1]=Ce,e[2]=Y):Y=e[2];const Ee=Y,We=as;let ee;e[3]===Symbol.for("react.memo_cache_sentinel")?(ee=t=>{X(t),Fe(!0)},e[3]=ee):ee=e[3];const Ze=ee;let se;e[4]!==d?(se=()=>{d&&$e.post(`/admin/escrow/payments/${d}/fee-release`,{},{onSuccess:()=>{Fe(!1),X(null)}})},e[4]=d,e[5]=se):se=e[5];const Pe=se;let te;e[6]===Symbol.for("react.memo_cache_sentinel")?(te=t=>{X(t),De(!0)},e[6]=te):te=e[6];const Je=te;let ne;e[7]!==d?(ne=()=>{d&&$e.post(`/admin/escrow/payments/${d}/fund-return`,{},{onSuccess:()=>{De(!1),X(null)}})},e[7]=d,e[8]=ne):ne=e[8];const Be=ne,i=cs;let re;e[9]===Symbol.for("react.memo_cache_sentinel")?(re=s.jsx(Ke,{title:"Admin - Escrow Management"}),e[9]=re):re=e[9];let le;e[10]===Symbol.for("react.memo_cache_sentinel")?(le=s.jsx("h1",{className:"text-2xl font-bold",children:"Escrow Management"}),e[10]=le):le=e[10];let ie;e[11]===Symbol.for("react.memo_cache_sentinel")?(ie=s.jsxs("div",{className:"flex items-center justify-between",children:[le,s.jsx(Qe,{href:"/admin/escrow/balances",children:s.jsx(q,{variant:"outline",children:"View All Balances"})})]}),e[11]=ie):ie=e[11];let oe;e[12]===Symbol.for("react.memo_cache_sentinel")?(oe=s.jsx(a,{children:s.jsxs(m,{className:"flex items-center gap-2",children:[s.jsx(rs,{className:"h-5 w-5"}),"Platform Escrow Account"]})}),e[12]=oe):oe=e[12];const Le=Ve||"Not configured";let h;e[13]!==Le?(h=s.jsx("p",{className:"text-sm font-mono",children:Le}),e[13]=Le,e[14]=h):h=e[14];let ce;e[15]===Symbol.for("react.memo_cache_sentinel")?(ce=s.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All businesses deposit into this account"}),e[15]=ce):ce=e[15];let p;e[16]!==h?(p=s.jsxs(o,{children:[oe,s.jsxs(c,{children:[h,ce]})]}),e[16]=h,e[17]=p):p=e[17];let ae;e[18]===Symbol.for("react.memo_cache_sentinel")?(ae=s.jsx(a,{children:s.jsx(m,{children:"Pending Deposits"})}),e[18]=ae):ae=e[18];let j;e[19]!==f.length?(j=s.jsx("p",{className:"text-3xl font-bold",children:f.length}),e[19]=f.length,e[20]=j):j=e[20];let me;e[21]===Symbol.for("react.memo_cache_sentinel")?(me=s.jsx("p",{className:"text-sm text-muted-foreground",children:"Awaiting bank confirmation"}),e[21]=me):me=e[21];let b;e[22]!==j?(b=s.jsxs(o,{children:[ae,s.jsxs(c,{children:[j,me]})]}),e[22]=j,e[23]=b):b=e[23];let de;e[24]===Symbol.for("react.memo_cache_sentinel")?(de=s.jsx(a,{children:s.jsx(m,{children:"Total Businesses"})}),e[24]=de):de=e[24];let g;e[25]!==n.length?(g=s.jsx("p",{className:"text-3xl font-bold",children:n.length}),e[25]=n.length,e[26]=g):g=e[26];let fe;e[27]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx("p",{className:"text-sm text-muted-foreground",children:"With escrow deposits"}),e[27]=fe):fe=e[27];let _;e[28]!==g?(_=s.jsxs(o,{children:[de,s.jsxs(c,{children:[g,fe]})]}),e[28]=g,e[29]=_):_=e[29];let N;e[30]!==p||e[31]!==b||e[32]!==_?(N=s.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[p,b,_]}),e[30]=p,e[31]=b,e[32]=_,e[33]=N):N=e[33];let xe;e[34]===Symbol.for("react.memo_cache_sentinel")?(xe=s.jsx(a,{children:s.jsx(m,{children:"Manually Record Deposit"})}),e[34]=xe):xe=e[34];let ue;e[35]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx(ze,{htmlFor:"business_id",children:"Business"}),e[35]=ue):ue=e[35];const Oe=String(x.business_id);let y;e[36]!==l?(y=t=>l("business_id",t),e[36]=l,e[37]=y):y=e[37];let he;e[38]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx(Xe,{children:s.jsx(Ye,{placeholder:"Select business"})}),e[38]=he):he=e[38];let S;e[39]!==n?(S=n.map(os),e[39]=n,e[40]=S):S=e[40];let v;e[41]!==S?(v=s.jsx(es,{children:S}),e[41]=S,e[42]=v):v=e[42];let w;e[43]!==Oe||e[44]!==y||e[45]!==v?(w=s.jsxs(ss,{value:Oe,onValueChange:y,children:[he,v]}),e[43]=Oe,e[44]=y,e[45]=v,e[46]=w):w=e[46];let C;e[47]!==u.business_id?(C=s.jsx(He,{message:u.business_id}),e[47]=u.business_id,e[48]=C):C=e[48];let R;e[49]!==w||e[50]!==C?(R=s.jsxs("div",{children:[ue,w,C]}),e[49]=w,e[50]=C,e[51]=R):R=e[51];let pe;e[52]===Symbol.for("react.memo_cache_sentinel")?(pe=s.jsx(ze,{htmlFor:"amount",children:"Deposit Amount"}),e[52]=pe):pe=e[52];let k;e[53]!==l?(k=t=>l("amount",t.target.value),e[53]=l,e[54]=k):k=e[54];let F;e[55]!==x.amount||e[56]!==k?(F=s.jsx(Me,{id:"amount",type:"number",step:"0.01",min:"0.01",value:x.amount,onChange:k,required:!0}),e[55]=x.amount,e[56]=k,e[57]=F):F=e[57];let A;e[58]!==u.amount?(A=s.jsx(He,{message:u.amount}),e[58]=u.amount,e[59]=A):A=e[59];let D;e[60]!==F||e[61]!==A?(D=s.jsxs("div",{children:[pe,F,A]}),e[60]=F,e[61]=A,e[62]=D):D=e[62];let je;e[63]===Symbol.for("react.memo_cache_sentinel")?(je=s.jsx(ze,{htmlFor:"bank_reference",children:"Bank Reference (Optional)"}),e[63]=je):je=e[63];let E;e[64]!==l?(E=t=>l("bank_reference",t.target.value),e[64]=l,e[65]=E):E=e[65];let P;e[66]!==x.bank_reference||e[67]!==E?(P=s.jsxs("div",{children:[je,s.jsx(Me,{id:"bank_reference",value:x.bank_reference,onChange:E})]}),e[66]=x.bank_reference,e[67]=E,e[68]=P):P=e[68];let be;e[69]===Symbol.for("react.memo_cache_sentinel")?(be=s.jsx(ls,{className:"mr-2 h-4 w-4"}),e[69]=be):be=e[69];let B;e[70]!==Re?(B=s.jsxs(q,{type:"submit",disabled:Re,className:"w-full",children:[be,"Record Deposit"]}),e[70]=Re,e[71]=B):B=e[71];let L;e[72]!==Ee||e[73]!==R||e[74]!==D||e[75]!==P||e[76]!==B?(L=s.jsxs(o,{children:[xe,s.jsx(c,{children:s.jsxs("form",{onSubmit:Ee,className:"space-y-4",children:[R,D,P,B]})})]}),e[72]=Ee,e[73]=R,e[74]=D,e[75]=P,e[76]=B,e[77]=L):L=e[77];let ge;e[78]===Symbol.for("react.memo_cache_sentinel")?(ge=s.jsx(a,{children:s.jsx(m,{children:"Business Balances"})}),e[78]=ge):ge=e[78];let O;if(e[79]!==n){let t;e[81]===Symbol.for("react.memo_cache_sentinel")?(t=Ie=>s.jsxs("div",{className:"flex items-center justify-between border-b pb-2",children:[s.jsx("span",{className:"text-sm",children:Ie.name}),s.jsx("span",{className:"font-semibold",children:i(Ie.balance)})]},Ie.id),e[81]=t):t=e[81],O=n.map(t),e[79]=n,e[80]=O}else O=e[80];let I;e[82]!==n.length?(I=n.length===0&&s.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No businesses yet"}),e[82]=n.length,e[83]=I):I=e[83];let z;e[84]!==O||e[85]!==I?(z=s.jsxs(o,{children:[ge,s.jsx(c,{children:s.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[O,I]})})]}),e[84]=O,e[85]=I,e[86]=z):z=e[86];let $;e[87]!==L||e[88]!==z?($=s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[L,z]}),e[87]=L,e[88]=z,e[89]=$):$=e[89];let _e;e[90]===Symbol.for("react.memo_cache_sentinel")?(_e=s.jsx(a,{children:s.jsx(m,{children:"Pending Deposits (Awaiting Confirmation)"})}),e[90]=_e):_e=e[90];let T;e[91]!==f?(T=s.jsxs(o,{children:[_e,s.jsx(c,{children:f.length>0?s.jsx("div",{className:"space-y-4",children:f.map(t=>s.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold",children:t.business.name}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[i(t.amount)," • Fee: ",i(t.fee_amount)," • Authorized: ",i(t.authorized_amount)]}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Recorded: ",new Date(t.deposited_at).toLocaleString(),t.entered_by&&` by ${t.entered_by.name}`]})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(q,{size:"sm",onClick:()=>We(t.id),variant:"outline",children:[s.jsx(ns,{className:"mr-2 h-4 w-4"}),"Confirm"]})})]},t.id))}):s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending deposits"})})]}),e[91]=f,e[92]=T):T=e[92];let Ne;e[93]===Symbol.for("react.memo_cache_sentinel")?(Ne=s.jsx(a,{children:s.jsx(m,{children:"Recent Confirmed Deposits"})}),e[93]=Ne):Ne=e[93];let M;e[94]!==G?(M=s.jsxs(o,{children:[Ne,s.jsx(c,{children:G.length>0?s.jsx("div",{className:"space-y-4",children:G.map(t=>s.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:t.business.name}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[i(t.amount)," • Authorized: ",i(t.authorized_amount)]}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Confirmed: ",new Date(t.completed_at).toLocaleString(),t.bank_reference&&` • Ref: ${t.bank_reference}`]})]}),s.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"Confirmed"})]},t.id))}):s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No confirmed deposits yet"})})]}),e[94]=G,e[95]=M):M=e[95];let ye;e[96]===Symbol.for("react.memo_cache_sentinel")?(ye=s.jsxs(a,{children:[s.jsx(m,{children:"Payment Operations - Fee Releases"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Record fee releases for succeeded payments"})]}),e[96]=ye):ye=e[96];let H;e[97]!==K?(H=s.jsxs(o,{children:[ye,s.jsx(c,{children:K.length>0?s.jsx("div",{className:"space-y-4",children:K.map(t=>s.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:t.payment_schedule.business.name}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.payment_schedule.name," • ",t.recipient.name]}),s.jsxs("p",{className:"text-sm font-medium",children:[i(t.amount)," • Fee: ",t.escrow_deposit?i(t.escrow_deposit.fee_amount):"N/A"]}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Processed: ",new Date(t.processed_at).toLocaleString()]})]}),s.jsx(q,{size:"sm",onClick:()=>Ze(t.id),variant:"outline",children:"Record Fee Release"})]},t.id))}):s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No payments awaiting fee release recording"})})]}),e[97]=K,e[98]=H):H=e[98];let Se;e[99]===Symbol.for("react.memo_cache_sentinel")?(Se=s.jsxs(a,{children:[s.jsx(m,{children:"Payment Operations - Fund Returns"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Record fund returns for failed payments"})]}),e[99]=Se):Se=e[99];let V;e[100]!==Q?(V=s.jsxs(o,{children:[Se,s.jsx(c,{children:Q.length>0?s.jsx("div",{className:"space-y-4",children:Q.map(t=>s.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:t.payment_schedule.business.name}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.payment_schedule.name," • ",t.recipient.name]}),s.jsx("p",{className:"text-sm font-medium",children:i(t.amount)}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Failed: ",new Date(t.processed_at).toLocaleString()]})]}),s.jsx(q,{size:"sm",onClick:()=>Je(t.id),variant:"outline",children:"Record Fund Return"})]},t.id))}):s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No payments awaiting fund return recording"})})]}),e[100]=Q,e[101]=V):V=e[101];let W;e[102]!==N||e[103]!==$||e[104]!==T||e[105]!==M||e[106]!==H||e[107]!==V?(W=s.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[ie,N,$,T,M,H,V]}),e[102]=N,e[103]=$,e[104]=T,e[105]=M,e[106]=H,e[107]=V,e[108]=W):W=e[108];let Z;e[109]!==Pe||e[110]!==ke?(Z=s.jsx(Te,{open:ke,onOpenChange:Fe,onConfirm:Pe,title:"Record Fee Release",description:"Record that the bank has released the fee for this payment?",confirmText:"Confirm",variant:"info"}),e[109]=Pe,e[110]=ke,e[111]=Z):Z=e[111];let J;e[112]!==Be||e[113]!==Ae?(J=s.jsx(Te,{open:Ae,onOpenChange:De,onConfirm:Be,title:"Record Fund Return",description:"Record that the bank has returned funds for this failed payment?",confirmText:"Confirm",variant:"info"}),e[112]=Be,e[113]=Ae,e[114]=J):J=e[114];let ve;return e[115]!==W||e[116]!==Z||e[117]!==J?(ve=s.jsxs(Ue,{breadcrumbs:is,children:[re,W,Z,J]}),e[115]=W,e[116]=Z,e[117]=J,e[118]=ve):ve=e[118],ve}function os(r){return s.jsx(ts,{value:String(r.id),children:r.name},r.id)}function cs(r){return new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR"}).format(Number(r))}function as(r,e){$e.post(`/admin/escrow/deposits/${r}/confirm`,{bank_reference:e||""},{preserveScroll:!0,onSuccess:ds,onError:ms})}function ms(r){console.error("Error confirming deposit:",r)}function ds(){}export{Us as default};
