import{c as Ge,r as Ue,u as Je,j as t,H as Ke,L as Qe}from"./app-zh9bNfQA.js";import{I as c}from"./input-error-2-LekhPz.js";import{B as We}from"./createLucideIcon-BZjvJ1Zn.js";import{a as Ye,b as et,C as tt,c as lt}from"./card-BdZbHl6r.js";import{I as be}from"./input-DiGHHSH4.js";import{L as d}from"./label-Bimm6ppi.js";import{S as ve,a as Se,b as Ce,c as Ne,d as m}from"./select-Bf_U1fyU.js";import{T as st}from"./textarea-vl710I3f.js";import{C as Ze}from"./checkbox-C94gYSAr.js";import{A as rt}from"./app-layout-Du2zqNOn.js";/* empty css            */import"./index-BJwOBxES.js";import"./index-Bvd5418W.js";import"./chevron-down-C7_CWyHS.js";import"./x-BIBjS2Dr.js";import"./index-CaEI0-fE.js";import"./index-CvHCqEC4.js";import"./chevron-right-O9ILxyvV.js";import"./check-BlMOmQr2.js";import"./chevron-up-DTZu2ggr.js";import"./index-NEtNT4ix.js";import"./app-sidebar-header-CRr_1DPO.js";import"./appearance-dropdown-Bb28oTQN.js";import"./index-BH508O9j.js";import"./index-CcLcdVZM.js";import"./log-out-D2fYovF8.js";import"./badge-VllgXE3C.js";import"./proxy-CflicfAZ.js";import"./circle-check-B9uKMuXu.js";import"./loader-circle-DmMzF6DP.js";import"./circle-x-BKTi4obl.js";import"./circle-alert-PjDKICDi.js";import"./plus-DPynhUc-.js";import"./credit-card-DZtV9Y3R.js";import"./dollar-sign-DV-oRcFJ.js";import"./message-square-CrR61UD7.js";import"./file-text-DIkPgk9X.js";import"./users-DRMz8fhj.js";import"./user-check-D6rfO7ti.js";import"./clock-CEsoW84B.js";import"./shield-DgxHpXTb.js";const it=[{title:"Adjustments",href:"/adjustments"},{title:"Edit",href:"#"}];function Jt(n){const e=Ge.c(165),{adjustment:r,businesses:Ae,employee:p,payrollSchedules:Y}=n,[Fe,Ee]=Ue.useState(!1),ke=r.employee_id||null,Pe=r.payroll_schedule_id||null,we=r.adjustment_type||"deduction",Le=r.is_recurring??!0,Te=r.payroll_period_start||"",qe=r.payroll_period_end||"",De=r.description||"";let ee;e[0]!==r.amount||e[1]!==r.business_id||e[2]!==r.is_active||e[3]!==r.name||e[4]!==r.type||e[5]!==ke||e[6]!==Pe||e[7]!==we||e[8]!==Le||e[9]!==Te||e[10]!==qe||e[11]!==De?(ee={business_id:r.business_id,employee_id:ke,payroll_schedule_id:Pe,name:r.name,type:r.type,amount:r.amount,adjustment_type:we,is_recurring:Le,payroll_period_start:Te,payroll_period_end:qe,is_active:r.is_active,description:De},e[0]=r.amount,e[1]=r.business_id,e[2]=r.is_active,e[3]=r.name,e[4]=r.type,e[5]=ke,e[6]=Pe,e[7]=we,e[8]=Le,e[9]=Te,e[10]=qe,e[11]=De,e[12]=ee):ee=e[12];const{data:l,setData:s,put:Ie,processing:Re,errors:i}=Je(ee),o=p?.id||l.employee_id;let te;e[13]!==r.payroll_schedule_id||e[14]!==l.is_recurring||e[15]!==l.payroll_schedule_id||e[16]!==o||e[17]!==s?(te=()=>{const a=!l.is_recurring&&o&&l.payroll_schedule_id,ze=r.payroll_schedule_id!==l.payroll_schedule_id;a&&ze&&l.payroll_schedule_id&&(Ee(!0),fetch(`/adjustments/calculate-period?payroll_schedule_id=${l.payroll_schedule_id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(nt).then(ge=>{s("payroll_period_start",ge.payroll_period_start),s("payroll_period_end",ge.payroll_period_end),Ee(!1)}).catch(ge=>{console.error("Failed to calculate period:",ge),Ee(!1)}))},e[13]=r.payroll_schedule_id,e[14]=l.is_recurring,e[15]=l.payroll_schedule_id,e[16]=o,e[17]=s,e[18]=te):te=e[18];let le;e[19]!==l.is_recurring||e[20]!==l.payroll_schedule_id||e[21]!==o?(le=[l.payroll_schedule_id,l.is_recurring,o],e[19]=l.is_recurring,e[20]=l.payroll_schedule_id,e[21]=o,e[22]=le):le=e[22],Ue.useEffect(te,le);let se;e[23]!==r.id||e[24]!==Ie?(se=a=>{a.preventDefault(),Ie(`/adjustments/${r.id}`)},e[23]=r.id,e[24]=Ie,e[25]=se):se=e[25];const Ve=se;let re;e[26]===Symbol.for("react.memo_cache_sentinel")?(re=t.jsx(Ke,{title:"Edit Adjustment"}),e[26]=re):re=e[26];let ie;e[27]===Symbol.for("react.memo_cache_sentinel")?(ie=t.jsx(Ye,{children:t.jsx(et,{children:"Edit Adjustment"})}),e[27]=ie):ie=e[27];let u;e[28]!==p?(u=p&&t.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Employee-specific adjustment for:"}),t.jsx("p",{className:"font-medium",children:p.name})]}),e[28]=p,e[29]=u):u=e[29];let ae;e[30]===Symbol.for("react.memo_cache_sentinel")?(ae=t.jsx(d,{htmlFor:"business_id",children:"Business"}),e[30]=ae):ae=e[30];const $e=String(l.business_id);let _;e[31]!==s?(_=a=>s("business_id",Number(a)),e[31]=s,e[32]=_):_=e[32];const Be=!!p;let oe;e[33]===Symbol.for("react.memo_cache_sentinel")?(oe=t.jsx(Se,{children:t.jsx(Ce,{})}),e[33]=oe):oe=e[33];let h;e[34]!==Ae?(h=Ae.map(ot),e[34]=Ae,e[35]=h):h=e[35];let f;e[36]!==h?(f=t.jsx(Ne,{children:h}),e[36]=h,e[37]=f):f=e[37];let y;e[38]!==$e||e[39]!==_||e[40]!==Be||e[41]!==f?(y=t.jsxs(ve,{value:$e,onValueChange:_,disabled:Be,children:[oe,f]}),e[38]=$e,e[39]=_,e[40]=Be,e[41]=f,e[42]=y):y=e[42];let x;e[43]!==i.business_id?(x=t.jsx(c,{message:i.business_id}),e[43]=i.business_id,e[44]=x):x=e[44];let j;e[45]!==y||e[46]!==x?(j=t.jsxs("div",{children:[ae,y,x]}),e[45]=y,e[46]=x,e[47]=j):j=e[47];let ne;e[48]===Symbol.for("react.memo_cache_sentinel")?(ne=t.jsx(d,{htmlFor:"name",children:"Adjustment Name"}),e[48]=ne):ne=e[48];let g;e[49]!==s?(g=a=>s("name",a.target.value),e[49]=s,e[50]=g):g=e[50];let b;e[51]!==l.name||e[52]!==g?(b=t.jsx(be,{id:"name",value:l.name,onChange:g,placeholder:"e.g., Medical Aid, Pension Fund, Bonus",required:!0}),e[51]=l.name,e[52]=g,e[53]=b):b=e[53];let v;e[54]!==i.name?(v=t.jsx(c,{message:i.name}),e[54]=i.name,e[55]=v):v=e[55];let S;e[56]!==b||e[57]!==v?(S=t.jsxs("div",{children:[ne,b,v]}),e[56]=b,e[57]=v,e[58]=S):S=e[58];let de;e[59]===Symbol.for("react.memo_cache_sentinel")?(de=t.jsx(d,{htmlFor:"adjustment_type",children:"Adjustment Type"}),e[59]=de):de=e[59];let C;e[60]!==s?(C=a=>s("adjustment_type",a),e[60]=s,e[61]=C):C=e[61];let ce;e[62]===Symbol.for("react.memo_cache_sentinel")?(ce=t.jsx(Se,{children:t.jsx(Ce,{})}),e[62]=ce):ce=e[62];let pe;e[63]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsxs(Ne,{children:[t.jsx(m,{value:"deduction",children:"Deduction (reduces net salary)"}),t.jsx(m,{value:"addition",children:"Addition (increases net salary)"})]}),e[63]=pe):pe=e[63];let N;e[64]!==l.adjustment_type||e[65]!==C?(N=t.jsxs(ve,{value:l.adjustment_type,onValueChange:C,children:[ce,pe]}),e[64]=l.adjustment_type,e[65]=C,e[66]=N):N=e[66];let A;e[67]!==i.adjustment_type?(A=t.jsx(c,{message:i.adjustment_type}),e[67]=i.adjustment_type,e[68]=A):A=e[68];let F;e[69]!==N||e[70]!==A?(F=t.jsxs("div",{children:[de,N,A]}),e[69]=N,e[70]=A,e[71]=F):F=e[71];let me;e[72]===Symbol.for("react.memo_cache_sentinel")?(me=t.jsx(d,{htmlFor:"type",children:"Calculation Type"}),e[72]=me):me=e[72];let E;e[73]!==s?(E=a=>s("type",a),e[73]=s,e[74]=E):E=e[74];let ue;e[75]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx(Se,{children:t.jsx(Ce,{})}),e[75]=ue):ue=e[75];let _e;e[76]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsxs(Ne,{children:[t.jsx(m,{value:"fixed",children:"Fixed Amount"}),t.jsx(m,{value:"percentage",children:"Percentage"})]}),e[76]=_e):_e=e[76];let k;e[77]!==l.type||e[78]!==E?(k=t.jsxs(ve,{value:l.type,onValueChange:E,children:[ue,_e]}),e[77]=l.type,e[78]=E,e[79]=k):k=e[79];let P;e[80]!==i.type?(P=t.jsx(c,{message:i.type}),e[80]=i.type,e[81]=P):P=e[81];let w;e[82]!==k||e[83]!==P?(w=t.jsxs("div",{children:[me,k,P]}),e[82]=k,e[83]=P,e[84]=w):w=e[84];const He=l.type==="percentage"?"Percentage (%)":"Amount (ZAR)";let L;e[85]!==He?(L=t.jsx(d,{htmlFor:"amount",children:He}),e[85]=He,e[86]=L):L=e[86];const Oe=(l.type==="percentage","0.01"),Me=l.type==="percentage"?"100":void 0;let T;e[87]!==s?(T=a=>s("amount",a.target.value),e[87]=s,e[88]=T):T=e[88];let q;e[89]!==l.amount||e[90]!==Oe||e[91]!==Me||e[92]!==T?(q=t.jsx(be,{id:"amount",type:"number",step:Oe,min:"0",max:Me,value:l.amount,onChange:T,required:!0}),e[89]=l.amount,e[90]=Oe,e[91]=Me,e[92]=T,e[93]=q):q=e[93];let D;e[94]!==i.amount?(D=t.jsx(c,{message:i.amount}),e[94]=i.amount,e[95]=D):D=e[95];let I;e[96]!==l.type?(I=l.type==="percentage"&&t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Percentage of gross salary"}),e[96]=l.type,e[97]=I):I=e[97];let R;e[98]!==L||e[99]!==q||e[100]!==D||e[101]!==I?(R=t.jsxs("div",{children:[L,q,D,I]}),e[98]=L,e[99]=q,e[100]=D,e[101]=I,e[102]=R):R=e[102];let V;e[103]!==w||e[104]!==R?(V=t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w,R]}),e[103]=w,e[104]=R,e[105]=V):V=e[105];let $;e[106]!==s?($=a=>{s("is_recurring",a),a&&(s("payroll_period_start",""),s("payroll_period_end",""),s("payroll_schedule_id",null))},e[106]=s,e[107]=$):$=e[107];let B;e[108]!==l.is_recurring||e[109]!==$?(B=t.jsx(Ze,{id:"is_recurring",checked:l.is_recurring,onCheckedChange:$}),e[108]=l.is_recurring,e[109]=$,e[110]=B):B=e[110];let he;e[111]===Symbol.for("react.memo_cache_sentinel")?(he=t.jsx(d,{htmlFor:"is_recurring",className:"cursor-pointer",children:"Recurring (applied automatically on every payroll run)"}),e[111]=he):he=e[111];let H;e[112]!==B?(H=t.jsxs("div",{className:"flex items-center space-x-2",children:[B,he]}),e[112]=B,e[113]=H):H=e[113];let O;e[114]!==l.is_recurring||e[115]!==l.payroll_period_end||e[116]!==l.payroll_period_start||e[117]!==l.payroll_schedule_id||e[118]!==i.payroll_period_end||e[119]!==i.payroll_period_start||e[120]!==i.payroll_schedule_id||e[121]!==Fe||e[122]!==o||e[123]!==Y||e[124]!==s?(O=!l.is_recurring&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx(d,{htmlFor:"payroll_schedule_id",children:"Payroll Schedule *"}),t.jsxs(ve,{value:l.payroll_schedule_id?String(l.payroll_schedule_id):"",onValueChange:a=>{a?s("payroll_schedule_id",Number(a)):(s("payroll_schedule_id",null),o&&(s("payroll_period_start",""),s("payroll_period_end","")))},children:[t.jsx(Se,{children:t.jsx(Ce,{placeholder:"Select payroll schedule"})}),t.jsx(Ne,{children:Y&&Y.length>0?Y.map(at):t.jsx(m,{value:"",disabled:!0,children:"No active payroll schedules found"})})]}),t.jsx(c,{message:i.payroll_schedule_id})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted rounded-lg",children:[t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"payroll_period_start",children:["Payroll Period Start",o&&t.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(Auto-calculated)"})]}),t.jsx(be,{id:"payroll_period_start",type:"date",value:l.payroll_period_start,onChange:a=>s("payroll_period_start",a.target.value),required:!l.is_recurring,disabled:o,className:o?"bg-background":""}),Fe&&o&&t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Calculating period from schedule..."}),t.jsx(c,{message:i.payroll_period_start})]}),t.jsxs("div",{children:[t.jsxs(d,{htmlFor:"payroll_period_end",children:["Payroll Period End",o&&t.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(Auto-calculated)"})]}),t.jsx(be,{id:"payroll_period_end",type:"date",value:l.payroll_period_end,onChange:a=>s("payroll_period_end",a.target.value),required:!l.is_recurring,disabled:o,className:o?"bg-background":""}),t.jsx(c,{message:i.payroll_period_end})]})]}),o&&l.payroll_period_start&&t.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[t.jsx("strong",{children:"Note:"})," For employee-specific once-off adjustments, the payroll period is automatically calculated from the selected schedule. This ensures the adjustment will match exactly when the schedule processes payroll, preventing it from being applied to other schedules."]})})]}),e[114]=l.is_recurring,e[115]=l.payroll_period_end,e[116]=l.payroll_period_start,e[117]=l.payroll_schedule_id,e[118]=i.payroll_period_end,e[119]=i.payroll_period_start,e[120]=i.payroll_schedule_id,e[121]=Fe,e[122]=o,e[123]=Y,e[124]=s,e[125]=O):O=e[125];let fe;e[126]===Symbol.for("react.memo_cache_sentinel")?(fe=t.jsx(d,{htmlFor:"description",children:"Description (Optional)"}),e[126]=fe):fe=e[126];let M;e[127]!==s?(M=a=>s("description",a.target.value),e[127]=s,e[128]=M):M=e[128];let X;e[129]!==l.description||e[130]!==M?(X=t.jsx(st,{id:"description",value:l.description,onChange:M,rows:3}),e[129]=l.description,e[130]=M,e[131]=X):X=e[131];let U;e[132]!==i.description?(U=t.jsx(c,{message:i.description}),e[132]=i.description,e[133]=U):U=e[133];let W;e[134]!==X||e[135]!==U?(W=t.jsxs("div",{children:[fe,X,U]}),e[134]=X,e[135]=U,e[136]=W):W=e[136];let Z;e[137]!==s?(Z=a=>s("is_active",a),e[137]=s,e[138]=Z):Z=e[138];let z;e[139]!==l.is_active||e[140]!==Z?(z=t.jsx(Ze,{id:"is_active",checked:l.is_active,onCheckedChange:Z}),e[139]=l.is_active,e[140]=Z,e[141]=z):z=e[141];let ye;e[142]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx(d,{htmlFor:"is_active",className:"cursor-pointer",children:"Active (adjustment will be applied to payroll)"}),e[142]=ye):ye=e[142];let G;e[143]!==z?(G=t.jsxs("div",{className:"flex items-center space-x-2",children:[z,ye]}),e[143]=z,e[144]=G):G=e[144];let J;e[145]!==Re?(J=t.jsx(We,{type:"submit",disabled:Re,children:"Update Adjustment"}),e[145]=Re,e[146]=J):J=e[146];const Xe=p?`/employees/${p.id}/edit`:"/adjustments";let xe;e[147]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsx(We,{type:"button",variant:"outline",children:"Cancel"}),e[147]=xe):xe=e[147];let K;e[148]!==Xe?(K=t.jsx(Qe,{href:Xe,children:xe}),e[148]=Xe,e[149]=K):K=e[149];let Q;e[150]!==J||e[151]!==K?(Q=t.jsxs("div",{className:"flex gap-2",children:[J,K]}),e[150]=J,e[151]=K,e[152]=Q):Q=e[152];let je;return e[153]!==Ve||e[154]!==u||e[155]!==j||e[156]!==S||e[157]!==F||e[158]!==V||e[159]!==H||e[160]!==O||e[161]!==W||e[162]!==G||e[163]!==Q?(je=t.jsxs(rt,{breadcrumbs:it,children:[re,t.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:t.jsxs(tt,{children:[ie,t.jsx(lt,{children:t.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[u,j,S,F,V,H,O,W,G,Q]})})]})})]}),e[153]=Ve,e[154]=u,e[155]=j,e[156]=S,e[157]=F,e[158]=V,e[159]=H,e[160]=O,e[161]=W,e[162]=G,e[163]=Q,e[164]=je):je=e[164],je}function at(n){return t.jsxs(m,{value:String(n.id),children:[n.name," ",n.next_run_at&&`(${new Date(n.next_run_at).toLocaleDateString()})`]},n.id)}function ot(n){return t.jsx(m,{value:String(n.id),children:n.name},n.id)}function nt(n){if(!n.ok)throw new Error("Failed to calculate period");return n.json()}export{Jt as default};
