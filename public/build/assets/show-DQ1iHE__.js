const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/echo-CAG-tlvB.js","assets/app-DWDC-BVo.js","assets/app-DAJS1Vs6.css"])))=>i.map(i=>d[i]);
import{r,_ as X,j as e,H as K,L as U}from"./app-DWDC-BVo.js";import{I as V}from"./input-error-BbO5B7zM.js";import{B as I}from"./createLucideIcon-CDiNb0OM.js";import{B as N}from"./badge-BnVI9wD_.js";import{T as J}from"./textarea-D8Plv6wf.js";import{f as G}from"./format-relative-time-CysDwhSm.js";import{A as Q}from"./app-layout-Csx9VZt2.js";import{A as Y}from"./arrow-left-DgfFAESW.js";import{C as Z}from"./chevron-up-CvrNtOh9.js";import{C as ee}from"./chevron-down-BehZftUK.js";/* empty css            */import"./app-sidebar-header-r-OiXY8i.js";import"./index-B-id3RBu.js";import"./index-BspEiaub.js";import"./x-Cr_BKX42.js";import"./appearance-dropdown-Boh93vvE.js";import"./index-BCOzoWRm.js";import"./index-l1Yz4tBP.js";import"./index-CcLcdVZM.js";import"./log-out-CNw_jzHT.js";import"./chevron-right-TaOApODu.js";import"./proxy-8KyYWbtH.js";import"./circle-check-DngFYpsd.js";import"./loader-circle-_uqlEWjJ.js";import"./circle-x-DCRTT9my.js";import"./circle-alert-C7E7uvB-.js";import"./plus-BwK_Jy3D.js";import"./credit-card-DHCU20zw.js";import"./dollar-sign-DGtOSjhC.js";import"./message-square-DRz1er9_.js";import"./file-text-xQShroE0.js";import"./users-CtagEMWm.js";import"./user-check-Dt0Yb2Ws.js";import"./clock-D4ogtgGS.js";import"./shield-B0GD2scd.js";import"./index-apnaeyBA.js";const te=[".ticket.updated",".ticket.message.created"];function se(n){n&&typeof n.stopListening=="function"&&te.forEach(i=>n.stopListening(i))}const re=[{title:"Support Tickets",href:"/tickets"},{title:"Ticket Details",href:"#"}],ae={open:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",in_progress:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",closed:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"},ne={low:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",high:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"};function _(n){return n?[...n].reverse():[]}function Oe({ticket:n,messages:i}){const[a,S]=r.useState(n),[p,x]=r.useState(()=>_(i?.data??[])),[R,T]=r.useState(i?.current_page??1),[M,C]=r.useState(i?.last_page??1),[y,E]=r.useState(!1),[f,B]=r.useState(!1),b=r.useRef(null),g=r.useRef(null),k=r.useRef(!1),h=r.useRef(!1),L=r.useRef(!1),A=R<M;r.useEffect(()=>{S(n),x(_(i?.data??[])),T(i?.current_page??1),C(i?.last_page??1)},[n.id,n.updated_at,i?.current_page]);const[H,D]=r.useState(""),[j,P]=r.useState({}),[$,q]=r.useState(!1),F=t=>{t.preventDefault(),P({}),q(!0);const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";fetch(`/tickets/${a.id}/reply`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({message:H})}).then(async o=>{const s=await o.json().catch(()=>({}));o.ok&&o.status===201&&s.message?(D(""),h.current=!0,x(l=>l.find(u=>u.id===s.message.id)?l:[...l,s.message])):o.status===422&&s.errors&&P(s.errors)}).finally(()=>q(!1))},O=()=>{if(y||!A)return;const t=b.current,d=t?.scrollHeight??0,o=t?.scrollTop??0;E(!0),fetch(`/tickets/${a.id}/messages?page=${R+1}`,{headers:{Accept:"application/json"}}).then(s=>s.json()).then(s=>{if(s.data?.length){const l=_(s.data);k.current=!0,g.current={prevHeight:d,prevTop:o},x(u=>[...l,...u]),T(s.current_page),C(s.last_page)}}).finally(()=>E(!1))},w=r.useRef(null),v=r.useRef(null);return r.useEffect(()=>{if(a.status==="closed")return()=>{};const t=a.id;let d=!1;const o=()=>{if(!(typeof window>"u"||!window.Echo))try{se(w.current);const s=v.current;s!=null&&(window.Echo.leaveChannel(`ticket.${s}`),v.current=null),w.current=null}catch(s){console.error("WebSocket: Error cleaning up channels",s)}};return(async()=>{try{const s=(await X(async()=>{const{default:c}=await import("./echo-CAG-tlvB.js");return{default:c}},__vite__mapDeps([0,1,2]))).default();if(d||typeof window>"u")return;const l=c=>{c.message&&(h.current=!0,x(m=>m.find(W=>W.id===c.message.id)?m:[...m,c.message]))},u=c=>{S(m=>({...m,status:c.status||m.status}))},z=s.private(`ticket.${t}`).listen(".ticket.updated",u).listen(".ticket.message.created",l);d?s.leaveChannel(`ticket.${t}`):(w.current=z,v.current=t)}catch(s){console.error("Failed to initialize WebSocket:",s)}})(),()=>{d=!0,o()}},[a.id,a.status]),r.useEffect(()=>{const t=b.current;if(t){if(k.current&&g.current){k.current=!1;const{prevHeight:d,prevTop:o}=g.current;g.current=null,requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight-d+o});return}if(h.current){h.current=!1,requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight});return}p.length>0&&!L.current&&(L.current=!0,requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight}))}},[p]),e.jsxs(Q,{breadcrumbs:re,children:[e.jsx(K,{title:`Ticket: ${a.subject}`}),e.jsx("div",{className:"mx-auto flex w-full max-w-4xl flex-1 flex-col gap-2 overflow-hidden rounded-lg md:gap-3",children:e.jsxs("div",{className:"flex h-[calc(100vh-8rem)] min-h-[400px] flex-col overflow-hidden rounded-lg md:h-[calc(100vh-9rem)] md:min-h-[480px] md:border md:border-border md:bg-card md:shadow-sm",children:[e.jsxs("div",{className:"flex shrink-0 items-center gap-2 border-b bg-muted/30 px-3 py-2 dark:border-border md:gap-3 md:px-4 md:py-3",children:[e.jsx(U,{href:"/tickets",className:"shrink-0 text-muted-foreground hover:text-foreground",children:e.jsx(Y,{className:"h-4 w-4 md:h-5 md:w-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"truncate text-sm font-semibold md:text-base",children:a.subject}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground md:gap-3 md:text-sm",children:[e.jsx(N,{className:`shrink-0 text-[10px] md:text-xs ${ae[a.status]}`,children:a.status.replace("_"," ")}),e.jsx(N,{className:`shrink-0 text-[10px] md:text-xs ${ne[a.priority]}`,children:a.priority}),e.jsxs("span",{className:"shrink-0",children:[new Date(a.created_at).toLocaleDateString()," · ",a.user?.name]})]})]})]}),e.jsxs("div",{className:"shrink-0 border-b border-border/50 px-3 py-1 md:px-4 md:py-2",children:[e.jsxs("button",{type:"button",onClick:()=>B(t=>!t),className:"flex w-full items-center justify-between gap-2 py-1 text-left text-xs text-muted-foreground hover:text-foreground md:text-sm",children:[e.jsxs("span",{className:"truncate",children:[f?"Hide description":a.description?.slice(0,60),!f&&(a.description?.length??0)>60?"…":""]}),f?e.jsx(Z,{className:"h-3 w-3 shrink-0"}):e.jsx(ee,{className:"h-3 w-3 shrink-0"})]}),f&&e.jsx("p",{className:"whitespace-pre-wrap py-2 text-xs text-muted-foreground md:text-sm md:leading-relaxed",children:a.description})]}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col",children:[A&&e.jsx("div",{className:"shrink-0 flex justify-center border-b border-border/50 py-2 md:py-3",children:e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 text-xs md:h-8 md:text-sm",onClick:O,disabled:y,children:y?"Loading…":"Load messages from above"})}),e.jsx("div",{ref:b,className:"min-h-0 flex-1 overflow-y-auto px-2 py-2 md:px-4 md:py-4",children:e.jsx("div",{className:"flex flex-col gap-1.5 md:gap-3",children:p&&p.length>0?p.map(t=>e.jsxs("div",{className:`rounded-lg px-2.5 py-1.5 md:rounded-xl md:px-4 md:py-3 ${t.is_admin?"bg-primary/10 dark:bg-primary/20":"bg-muted/60 dark:bg-muted/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"text-xs font-medium md:text-sm",children:[t.user?.name,t.is_admin&&e.jsx(N,{variant:"outline",className:"ml-1.5 text-[10px] md:ml-2 md:text-xs",children:"Admin"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground md:text-xs",title:new Date(t.created_at).toLocaleString(),children:G(t.created_at)})]}),e.jsx("p",{className:"mt-0.5 whitespace-pre-wrap text-xs leading-snug md:mt-1 md:text-sm md:leading-relaxed",children:t.message})]},t.id)):e.jsx("p",{className:"py-6 text-center text-xs text-muted-foreground md:py-8 md:text-sm",children:"No messages yet."})})})]}),a.status!=="closed"&&e.jsxs("form",{onSubmit:F,className:"shrink-0 border-t border-border bg-background px-2 py-2 md:px-4 md:py-3",children:[e.jsxs("div",{className:"flex gap-2 md:gap-3",children:[e.jsx(J,{id:"message",value:H,onChange:t=>D(t.target.value),required:!0,rows:2,placeholder:"Type your reply…",className:"min-h-[52px] resize-none text-sm md:min-h-[72px] md:rows-3 md:text-base"}),e.jsx(I,{type:"submit",disabled:$,className:"shrink-0 self-end",children:$?"Sending…":"Send"})]}),e.jsx(V,{message:Array.isArray(j.message)?j.message[0]:j.message})]})]})})]})}export{Oe as default};
