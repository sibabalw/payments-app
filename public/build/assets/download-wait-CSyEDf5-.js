import{r as l,j as r,H as x}from"./app-Cuioih4f.js";import{A as h}from"./app-layout-n-d4l7tQ.js";import{L as S}from"./loader-circle-BHZ8O1kv.js";/* empty css            */import"./app-sidebar-header-C7CWWu21.js";import"./createLucideIcon-B5MOZI9f.js";import"./index-CfqSVWBk.js";import"./index-DcSYVg4d.js";import"./x-Bo-ZIIiE.js";import"./appearance-dropdown-Dd19dic0.js";import"./index-EFDA_sBj.js";import"./chevron-down-CZg7iP84.js";import"./index-Buc-yRrE.js";import"./index-Bs_TJoq4.js";import"./index-CcLcdVZM.js";import"./log-out-DgGKhRGZ.js";import"./chevron-right-BmA-IvWf.js";import"./badge-Bn6Vikwd.js";import"./proxy-Bhuhjzak.js";import"./circle-check-DtjdWYjd.js";import"./circle-x-BHtK7BJ7.js";import"./circle-alert-D33Q7hcZ.js";import"./plus-BYiZCxp8.js";import"./credit-card-DyUwoGG-.js";import"./dollar-sign-CmPq-nEC.js";import"./message-square-DDbRZnKk.js";import"./file-text-CHp8TDnm.js";import"./users-CdWaatQB.js";import"./user-check-BK_NFKR2.js";import"./clock-CSBq3vjr.js";import"./shield-U7oFjP4d.js";function Z({reportGeneration:a}){const[o,d]=l.useState(a.status),[m,i]=l.useState(null),[p,u]=l.useState(null);l.useEffect(()=>{const e=new EventSource(a.sse_url);let c=null,n=Date.now();return e.addEventListener("connected",()=>{console.log("SSE connection established"),n=Date.now()}),e.addEventListener("heartbeat",s=>{try{const t=JSON.parse(s.data);n=Date.now(),console.debug("SSE heartbeat received",t.timestamp)}catch(t){console.error("Error parsing heartbeat:",t)}}),e.addEventListener("close",()=>{console.log("SSE connection closed by server"),e.close()}),e.onmessage=s=>{try{const t=JSON.parse(s.data);n=Date.now(),d(t.status),t.status==="completed"?(u(t.download_url),t.download_url&&(window.location.href=t.download_url),e.close()):t.status==="failed"?(i(t.error_message||"Report generation failed"),e.close()):t.status==="timeout"&&(i("Report generation timed out. Please try again."),e.close())}catch(t){console.error("Error parsing SSE data:",t)}},e.onerror=s=>{console.error("SSE connection error:",s),Date.now()-n>6e4?(i("Connection lost. Please refresh the page."),e.close()):setTimeout(()=>{e.readyState===EventSource.CLOSED&&(o==="pending"||o==="processing")&&window.location.reload()},5e3)},c=setInterval(()=>{Date.now()-n>9e4&&(o==="pending"||o==="processing")&&(console.warn("SSE heartbeat timeout detected"),i("Connection lost. Please refresh the page."),e.close())},3e4),()=>{c&&clearInterval(c),e.close()}},[a.sse_url,o]);const f=()=>{switch(o){case"pending":return"Your report is queued for generation...";case"processing":return"Your report is being generated...";case"completed":return"Report ready! Download starting...";case"failed":return"Report generation failed";default:return"Preparing your report..."}},g=a.report_type.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");return r.jsxs(h,{children:[r.jsx(x,{title:"Generating Report"}),r.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center gap-6 p-8",children:r.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[r.jsx(S,{className:"h-12 w-12 animate-spin text-primary"}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Generating Report"}),r.jsxs("p",{className:"mt-2 text-muted-foreground",children:[g," (",a.format.toUpperCase(),")"]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("p",{className:"text-lg",children:f()}),m&&r.jsx("p",{className:"mt-2 text-sm text-destructive",children:m})]}),o==="completed"&&p&&r.jsx("div",{className:"mt-4",children:r.jsx("a",{href:p,className:"inline-flex items-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:"Download Report"})})]})})]})}export{Z as default};
