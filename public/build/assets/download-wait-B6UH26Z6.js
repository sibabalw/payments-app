import{r as l,j as r,H as x}from"./app-DlRq_5I-.js";import{A as h}from"./app-layout-B1Fh94R8.js";import{L as S}from"./loader-circle-DB6syjKq.js";/* empty css            */import"./app-sidebar-header-DViv9NrM.js";import"./createLucideIcon-DfICN48Q.js";import"./index-BlmLjsw4.js";import"./index-B1IOqWwB.js";import"./x-RYBOgl4T.js";import"./appearance-dropdown-kWEtid9a.js";import"./index-Dl5gb-Kb.js";import"./chevron-down-DBn0VZdD.js";import"./index-D8-tZbVS.js";import"./index-BC94lCP7.js";import"./index-CcLcdVZM.js";import"./log-out-BKe7v_gT.js";import"./chevron-right-FxPRos96.js";import"./badge-DkQNu0Ve.js";import"./proxy-DB18oa0z.js";import"./circle-check-CTpeSp7r.js";import"./circle-x-DCpd_SlB.js";import"./circle-alert-BMPPz6PA.js";import"./plus-CLDQrfk-.js";import"./credit-card-BEASO8FW.js";import"./dollar-sign-CAhazD9z.js";import"./message-square-BIfa93Ti.js";import"./file-text-DtJO93Xu.js";import"./users-DkXA52Op.js";import"./user-check-BIHcPLhA.js";import"./clock-eJfs3CCo.js";import"./shield-Bc8H0Rwn.js";function Z({reportGeneration:a}){const[o,d]=l.useState(a.status),[m,i]=l.useState(null),[p,u]=l.useState(null);l.useEffect(()=>{const e=new EventSource(a.sse_url);let c=null,n=Date.now();return e.addEventListener("connected",()=>{console.log("SSE connection established"),n=Date.now()}),e.addEventListener("heartbeat",s=>{try{const t=JSON.parse(s.data);n=Date.now(),console.debug("SSE heartbeat received",t.timestamp)}catch(t){console.error("Error parsing heartbeat:",t)}}),e.addEventListener("close",()=>{console.log("SSE connection closed by server"),e.close()}),e.onmessage=s=>{try{const t=JSON.parse(s.data);n=Date.now(),d(t.status),t.status==="completed"?(u(t.download_url),t.download_url&&(window.location.href=t.download_url),e.close()):t.status==="failed"?(i(t.error_message||"Report generation failed"),e.close()):t.status==="timeout"&&(i("Report generation timed out. Please try again."),e.close())}catch(t){console.error("Error parsing SSE data:",t)}},e.onerror=s=>{console.error("SSE connection error:",s),Date.now()-n>6e4?(i("Connection lost. Please refresh the page."),e.close()):setTimeout(()=>{e.readyState===EventSource.CLOSED&&(o==="pending"||o==="processing")&&window.location.reload()},5e3)},c=setInterval(()=>{Date.now()-n>9e4&&(o==="pending"||o==="processing")&&(console.warn("SSE heartbeat timeout detected"),i("Connection lost. Please refresh the page."),e.close())},3e4),()=>{c&&clearInterval(c),e.close()}},[a.sse_url,o]);const f=()=>{switch(o){case"pending":return"Your report is queued for generation...";case"processing":return"Your report is being generated...";case"completed":return"Report ready! Download starting...";case"failed":return"Report generation failed";default:return"Preparing your report..."}},g=a.report_type.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");return r.jsxs(h,{children:[r.jsx(x,{title:"Generating Report"}),r.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center gap-6 p-8",children:r.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[r.jsx(S,{className:"h-12 w-12 animate-spin text-primary"}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Generating Report"}),r.jsxs("p",{className:"mt-2 text-muted-foreground",children:[g," (",a.format.toUpperCase(),")"]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("p",{className:"text-lg",children:f()}),m&&r.jsx("p",{className:"mt-2 text-sm text-destructive",children:m})]}),o==="completed"&&p&&r.jsx("div",{className:"mt-4",children:r.jsx("a",{href:p,className:"inline-flex items-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:"Download Report"})})]})})]})}export{Z as default};
