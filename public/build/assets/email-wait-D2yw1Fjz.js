import{r as c,j as e,H as h,a as p}from"./app-DlRq_5I-.js";import{A as y}from"./app-layout-B1Fh94R8.js";import{B as m}from"./createLucideIcon-DfICN48Q.js";import{C as S,a as j,b as w,c as v}from"./card-BpVtH_kK.js";import{M as N}from"./mail-Bz9icqyX.js";import{L as u}from"./loader-circle-DB6syjKq.js";import{C as b}from"./circle-x-DCpd_SlB.js";import{C as E}from"./circle-check-CTpeSp7r.js";/* empty css            */import"./app-sidebar-header-DViv9NrM.js";import"./index-BlmLjsw4.js";import"./index-B1IOqWwB.js";import"./x-RYBOgl4T.js";import"./appearance-dropdown-kWEtid9a.js";import"./index-Dl5gb-Kb.js";import"./chevron-down-DBn0VZdD.js";import"./index-D8-tZbVS.js";import"./index-BC94lCP7.js";import"./index-CcLcdVZM.js";import"./log-out-BKe7v_gT.js";import"./chevron-right-FxPRos96.js";import"./badge-DkQNu0Ve.js";import"./proxy-DB18oa0z.js";import"./circle-alert-BMPPz6PA.js";import"./plus-CLDQrfk-.js";import"./credit-card-BEASO8FW.js";import"./dollar-sign-CAhazD9z.js";import"./message-square-BIfa93Ti.js";import"./file-text-DtJO93Xu.js";import"./users-DkXA52Op.js";import"./user-check-BIHcPLhA.js";import"./clock-eJfs3CCo.js";import"./shield-Bc8H0Rwn.js";const C={csv:"CSV",excel:"Excel",pdf:"PDF"},_={payroll_summary:"Payroll Summary",payroll_by_employee:"Payroll by Employee",tax_summary:"Tax Summary",deductions_summary:"Deductions Summary",payment_summary:"Payment Summary",employee_earnings:"Employee Earnings"};function ne({reportGeneration:r}){const[t,x]=c.useState(r.status),[d,i]=c.useState(null);let n=null,l=Date.now();c.useEffect(()=>{const s=new EventSource(r.sse_url);return s.addEventListener("connected",()=>{console.log("SSE connection established"),l=Date.now()}),s.addEventListener("heartbeat",o=>{try{const a=JSON.parse(o.data);l=Date.now(),console.debug("SSE heartbeat received",a.timestamp)}catch(a){console.error("Error parsing heartbeat:",a)}}),s.addEventListener("close",()=>{console.log("SSE connection closed by server"),s.close()}),s.onmessage=o=>{try{const a=JSON.parse(o.data);l=Date.now(),x(a.status),a.status==="completed"?s.close():a.status==="failed"?(i(a.error_message||"Report generation failed"),s.close()):a.status==="timeout"&&(i("Report generation timed out. Please try again."),s.close())}catch(a){console.error("Error parsing SSE data:",a)}},s.onerror=o=>{console.error("SSE connection error:",o),Date.now()-l>6e4?(i("Connection lost. Please refresh the page."),s.close()):setTimeout(()=>{s.readyState===EventSource.CLOSED&&(t==="pending"||t==="processing")&&window.location.reload()},5e3)},n=setInterval(()=>{Date.now()-l>6e4&&(t==="pending"||t==="processing")&&(i("Connection timeout. Please refresh the page."),s.close())},1e4),()=>{n&&clearInterval(n),s.close()}},[r.sse_url,t]);const f=()=>{switch(t){case"pending":return"Queuing report generation...";case"processing":return"Generating your report...";case"completed":return"Report generated successfully! Check your email for the download link.";case"failed":return d||"Report generation failed.";default:return"Processing..."}},g=()=>{switch(t){case"pending":case"processing":return e.jsx(u,{className:"h-8 w-8 animate-spin text-primary"});case"completed":return e.jsx(E,{className:"h-8 w-8 text-green-600"});case"failed":return e.jsx(b,{className:"h-8 w-8 text-red-600"});default:return e.jsx(u,{className:"h-8 w-8 animate-spin text-primary"})}};return e.jsxs(y,{children:[e.jsx(h,{title:"Generating Report"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:e.jsxs(S,{className:"mx-auto max-w-2xl",children:[e.jsx(j,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Sending Report via Email"]})}),e.jsxs(v,{className:"flex flex-col items-center gap-6 py-12",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[g(),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium",children:f()}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:[_[r.report_type]||r.report_type," -"," ",C[r.format]||r.format.toUpperCase()]})]})]}),(t==="pending"||t==="processing")&&e.jsx("div",{className:"w-full max-w-md",children:e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:t==="pending"?"30%":t==="processing"?"70%":"100%"}})})}),t==="completed"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Your report has been generated and sent to your email address. Please check your inbox."}),e.jsx(m,{onClick:()=>p.visit("/reports"),className:"w-full",children:"Back to Reports"})]}),t==="failed"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-center text-sm text-red-600",children:d}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>p.visit("/reports"),className:"flex-1",children:"Back to Reports"}),e.jsx(m,{onClick:()=>window.location.reload(),className:"flex-1",children:"Try Again"})]})]})]})]})})]})}export{ne as default};
