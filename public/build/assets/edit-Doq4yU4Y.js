import{r as _,u as L,j as e,H as T,L as p}from"./app-BRoNAUIM.js";import{I as d}from"./input-error-jm3AyEfT.js";import{B as x}from"./x-pZV5lkp5.js";import{C as f,a as y,b as v,c as b}from"./card-Bag7gWUQ.js";import{I as m}from"./input-6bP_JhyV.js";import{L as o}from"./label-BAqrWHKw.js";import{S as F,a as N,b as S,c as w,d as h}from"./select-Cv0uEHLH.js";import{A as R}from"./app-layout-Bn-75oUf.js";/* empty css            */import"./index-CBJSSLbQ.js";import"./index-CfMSX17F.js";import"./index-BohsM0ZD.js";import"./check-CU7v0mdS.js";import"./chevron-up-DDm2opro.js";import"./app-sidebar-header-BbzcXdQi.js";import"./appearance-dropdown-BEtN_wNg.js";import"./index-Cfp_L9w6.js";import"./log-out-MC42nTzo.js";import"./badge-ZsznMIyW.js";import"./proxy-CQkt3OrQ.js";import"./circle-check-DIHwzO_b.js";import"./loader-circle-CafrvZjs.js";import"./circle-x-C4YAnoMU.js";import"./circle-alert-COfzFcbZ.js";import"./plus-C6lF1Clu.js";import"./dollar-sign-CDLUu5fH.js";import"./message-square-CEp_sz_O.js";import"./file-text-FWLsz4T5.js";import"./users-CEYKQlp0.js";import"./user-check-DiuzZ-7a.js";import"./clock-DWicTrer.js";import"./shield-Kl3V0fgW.js";const I=[{title:"Employees",href:"/employees"},{title:"Edit",href:"#"}];function je({employee:s,businesses:C,taxBreakdown:D,adjustments:B}){const[i,j]=_.useState(D),{data:r,setData:l,put:A,processing:k,errors:n}=L({business_id:s.business_id,name:s.name,email:s.email||"",id_number:s.id_number||"",tax_number:s.tax_number||"",employment_type:s.employment_type,hours_worked_per_month:s.hours_worked_per_month||"",department:s.department||"",start_date:s.start_date||"",gross_salary:s.gross_salary,hourly_rate:s.hourly_rate||"",overtime_rate_multiplier:s.overtime_rate_multiplier||1.5,weekend_rate_multiplier:s.weekend_rate_multiplier||1.5,holiday_rate_multiplier:s.holiday_rate_multiplier||2,bank_account_details:s.bank_account_details||{},tax_status:s.tax_status||"",notes:s.notes||""});_.useEffect(()=>{const t=async()=>{if(!r.gross_salary||parseFloat(r.gross_salary)<=0){j(null);return}try{const a=`/employees/${s.id}/calculate-tax`,c={};parseFloat(r.gross_salary)!==parseFloat(s.gross_salary)&&(c.gross_salary=parseFloat(r.gross_salary)),c.business_id=r.business_id,c.employee_id=s.id;const g=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(c)});if(g.ok){const Z=await g.json();j(Z)}}catch(a){console.error("Error calculating tax:",a)}},u=setTimeout(()=>{t()},500);return()=>clearTimeout(u)},[r.gross_salary,r.business_id,s.id,s.gross_salary]);const E=t=>{t.preventDefault(),A(`/employees/${s.id}`)};return e.jsxs(R,{breadcrumbs:I,children:[e.jsx(T,{title:"Edit Employee"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Edit Employee"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{href:`/employees/${s.id}/benefits`,children:e.jsx(x,{variant:"outline",children:"View Benefits or Deductions"})}),e.jsx(p,{href:`/payroll/bonuses/create?employee_id=${s.id}`,children:e.jsx(x,{variant:"outline",children:"Add Bonus"})})]})]}),e.jsxs(f,{children:[e.jsx(y,{children:e.jsx(v,{children:"Employee Details"})}),e.jsx(b,{children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"business_id",children:"Business"}),e.jsxs(F,{value:String(r.business_id),onValueChange:t=>l("business_id",Number(t)),children:[e.jsx(N,{children:e.jsx(S,{})}),e.jsx(w,{children:C.map(t=>e.jsx(h,{value:String(t.id),children:t.name},t.id))})]}),e.jsx(d,{message:n.business_id})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name",children:"Name"}),e.jsx(m,{id:"name",value:r.name,onChange:t=>l("name",t.target.value),required:!0}),e.jsx(d,{message:n.name})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"email",children:"Email"}),e.jsx(m,{id:"email",type:"email",value:r.email,onChange:t=>l("email",t.target.value)}),e.jsx(d,{message:n.email})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"id_number",children:"ID Number"}),e.jsx(m,{id:"id_number",value:r.id_number,onChange:t=>l("id_number",t.target.value)}),e.jsx(d,{message:n.id_number})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tax_number",children:"Tax Number"}),e.jsx(m,{id:"tax_number",value:r.tax_number,onChange:t=>l("tax_number",t.target.value)}),e.jsx(d,{message:n.tax_number})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employment_type",children:"Employment Type"}),e.jsxs(F,{value:r.employment_type,onValueChange:t=>l("employment_type",t),children:[e.jsx(N,{children:e.jsx(S,{})}),e.jsxs(w,{children:[e.jsx(h,{value:"full_time",children:"Full Time"}),e.jsx(h,{value:"part_time",children:"Part Time"}),e.jsx(h,{value:"contract",children:"Contract"})]})]}),e.jsx(d,{message:n.employment_type})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"department",children:"Department"}),e.jsx(m,{id:"department",value:r.department,onChange:t=>l("department",t.target.value)}),e.jsx(d,{message:n.department})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"start_date",children:"Start Date"}),e.jsx(m,{id:"start_date",type:"date",value:r.start_date,onChange:t=>l("start_date",t.target.value)}),e.jsx(d,{message:n.start_date})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"gross_salary",children:"Gross Salary (ZAR)"}),e.jsx(m,{id:"gross_salary",type:"number",step:"0.01",min:"0",value:r.gross_salary,onChange:t=>l("gross_salary",t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Used for fixed salary employees. Leave empty if using hourly rate."}),e.jsx(d,{message:n.gross_salary})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Hourly Rate Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"If set, salary will be calculated from time entries. Leave empty to use fixed gross salary."}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"hourly_rate",children:"Hourly Rate (ZAR)"}),e.jsx(m,{id:"hourly_rate",type:"number",step:"0.01",min:"0",value:r.hourly_rate,onChange:t=>l("hourly_rate",t.target.value)}),e.jsx(d,{message:n.hourly_rate})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"overtime_rate_multiplier",children:"Overtime Multiplier"}),e.jsx(m,{id:"overtime_rate_multiplier",type:"number",step:"0.1",min:"1",value:r.overtime_rate_multiplier,onChange:t=>l("overtime_rate_multiplier",t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Default: 1.5x"}),e.jsx(d,{message:n.overtime_rate_multiplier})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"weekend_rate_multiplier",children:"Weekend Multiplier"}),e.jsx(m,{id:"weekend_rate_multiplier",type:"number",step:"0.1",min:"1",value:r.weekend_rate_multiplier,onChange:t=>l("weekend_rate_multiplier",t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Default: 1.5x"}),e.jsx(d,{message:n.weekend_rate_multiplier})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"holiday_rate_multiplier",children:"Holiday Multiplier"}),e.jsx(m,{id:"holiday_rate_multiplier",type:"number",step:"0.1",min:"1",value:r.holiday_rate_multiplier,onChange:t=>l("holiday_rate_multiplier",t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Default: 2.0x"}),e.jsx(d,{message:n.holiday_rate_multiplier})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(p,{href:`/employees/${s.id}/schedule`,children:e.jsx(x,{type:"button",variant:"outline",children:"Manage Work Schedule"})}),e.jsx(p,{href:`/employees/${s.id}/payslips`,children:e.jsx(x,{type:"button",variant:"outline",children:"View Payslips"})})]})]}),i&&e.jsxs(f,{className:"bg-muted",children:[e.jsx(y,{children:e.jsx(v,{className:"text-lg",children:"Deduction Calculation Preview"})}),e.jsxs(b,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Gross Salary:"}),e.jsxs("span",{className:"font-medium",children:["ZAR ",parseFloat(i.gross).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(()=>{const t=parseFloat(i.gross),u=a=>t===0?0:a/t*100;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"PAYE:"}),e.jsxs("span",{children:["- ZAR ",parseFloat(i.paye).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",u(parseFloat(i.paye)).toFixed(2),"%)"]})]})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"UIF:"}),e.jsxs("span",{children:["- ZAR ",parseFloat(i.uif).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",u(parseFloat(i.uif)).toFixed(2),"%)"]})]})]}),i.adjustments&&i.adjustments.length>0&&e.jsxs(e.Fragment,{children:[i.adjustments.filter(a=>(a.adjustment_type||"deduction")==="deduction").map((a,c)=>e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsxs("span",{children:[a.name,":"]}),e.jsxs("span",{children:["- ZAR ",parseFloat(a.amount).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2}),a.type==="percentage"?e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",parseFloat(a.original_amount||a.amount).toFixed(2),"%)"]}):e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",u(parseFloat(a.amount)).toFixed(2),"%)"]})]})]},`deduction-${c}`)),i.adjustments.filter(a=>(a.adjustment_type||"deduction")==="addition").map((a,c)=>e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:[a.name,":"]}),e.jsxs("span",{children:["+ ZAR ",parseFloat(a.amount).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2}),a.type==="percentage"?e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",parseFloat(a.original_amount||a.amount).toFixed(2),"%)"]}):e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",u(parseFloat(a.amount)).toFixed(2),"%)"]})]})]},`addition-${c}`))]})]})})(),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[e.jsx("span",{children:"Net Salary:"}),e.jsxs("span",{className:"text-green-600",children:["ZAR ",parseFloat(i.final_net_salary||i.net).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),parseFloat(i.sdl)>0&&e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"SDL (Employer Cost - not deducted from employee):"}),e.jsxs("span",{children:["ZAR ",parseFloat(i.sdl).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tax_status",children:"Tax Status"}),e.jsx(m,{id:"tax_status",value:r.tax_status,onChange:t=>l("tax_status",t.target.value)}),e.jsx(d,{message:n.tax_status})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"submit",disabled:k,children:"Update Employee"}),e.jsx(p,{href:"/employees",children:e.jsx(x,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]})]})]})}export{je as default};
