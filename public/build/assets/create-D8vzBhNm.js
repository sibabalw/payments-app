import{r as l,u as $,j as e,H as z,L as Y}from"./app-CMeUrf50.js";import{I as m}from"./input-error-DGa17wxa.js";import{B as h,X as J}from"./x-CZYrHTRQ.js";import{C as K,a as Q,b as Z,c as ee}from"./card-Cwxw5GdZ.js";import{I as b}from"./input-CJwM-rHG.js";import{L as i}from"./label-k3FBp3Ud.js";import{S,a as _,b as N,c as w,d as x}from"./select-BU5oTjNs.js";import{T as se}from"./textarea-BwmfAh2i.js";import{C as A}from"./checkbox-tAXJ8-6B.js";import{A as te,P as re,a as ae,b as ne}from"./app-layout-nNCjU6Ur.js";import{P as ie}from"./plus-BJ4kQvgy.js";import{f as L}from"./format-BS8Ay9AX.js";/* empty css            */import"./index-CASGKN-W.js";import"./index-BQCSxHRW.js";import"./index-wVJuMR_H.js";import"./check-DXgzueCv.js";import"./chevron-up-B8DO_JqK.js";import"./appearance-dropdown-CIplfUHR.js";import"./app-sidebar-header-CztvwVfL.js";import"./index-Cfp_L9w6.js";import"./log-out-C9Jhd31W.js";import"./badge-CpbHZjhE.js";import"./proxy-B-sAeQ2V.js";import"./circle-check-Bv3Kk_K_.js";import"./loader-circle-PC8s1h8o.js";import"./circle-x-qFpOssZO.js";import"./circle-alert-tomiUAeh.js";import"./dollar-sign-3i0DvXHD.js";import"./message-square-Bem12P6R.js";import"./file-text-DBGV6D9F.js";import"./users-BjCKGoHP.js";import"./user-check-B_uMkO9r.js";import"./clock-C3FzQv_v.js";import"./shield-CzJFJRG5.js";const le=[{title:"Payroll",href:"/payroll"},{title:"Bonuses",href:"/payroll/bonuses"},{title:"Add Bonus",href:"#"}];function Ve({businesses:j,selectedBusinessId:R,employee:o,employees:M}){const C=new URLSearchParams(window.location.search),U=C.get("business_id"),D=C.get("employee_id"),[p,P]=l.useState(o?.id||D?"select":"all"),[n,f]=l.useState(o?.id?[o.id]:[]),[u,E]=l.useState(""),[I,g]=l.useState([]),[T,B]=l.useState(!1),v=l.useRef(null),F=new Date().toISOString().slice(0,7),q=new Date(Date.now()+720*60*60*1e3).toISOString().slice(0,7),[y,H]=l.useState(F),{data:r,setData:t,post:O,processing:k,errors:d}=$({business_id:R||U||j[0]?.id||"",employee_id:o?.id||D||null,employee_ids:[],name:"",type:"fixed",amount:"",adjustment_type:"addition",period_start:"",period_end:"",is_active:!0,description:""});l.useEffect(()=>{if(y){const[s,a]=y.split("-"),c=new Date(parseInt(s),parseInt(a)-1,1),X=new Date(parseInt(s),parseInt(a),0);t("period_start",L(c,"yyyy-MM-dd")),t("period_end",L(X,"yyyy-MM-dd"))}},[y]),l.useEffect(()=>{if(v.current&&clearTimeout(v.current),!u.trim()||!r.business_id){g([]);return}v.current=setTimeout(async()=>{B(!0);try{const s=new URLSearchParams({business_id:String(r.business_id),query:u.trim()}),a=await fetch(`/employees/search?${s.toString()}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(a.ok){const c=await a.json();g(c)}}catch(s){console.error("Search error:",s)}finally{B(!1)}},300)},[u,r.business_id]);const V=s=>{n.includes(s.id)||(f([...n,s.id]),t("employee_ids",[...n,s.id])),E(""),g([])},G=s=>{const a=n.filter(c=>c!==s);f(a),t("employee_ids",a),a.length===0&&t("employee_id",null)},W=s=>{s.preventDefault(),p==="all"?(t("employee_id",null),t("employee_ids",[])):p==="select"&&(n.length===1?(t("employee_id",n[0]),t("employee_ids",[])):(t("employee_id",null),t("employee_ids",n))),O("/payroll/bonuses")};return e.jsxs(te,{breadcrumbs:le,children:[e.jsx(z,{title:"Add Bonus"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Add Bonus"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"One-time bonus or allowance for a specific period"})]})}),o&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bonus for:"}),e.jsx("p",{className:"font-medium",children:o.name})]}),e.jsxs(K,{children:[e.jsx(Q,{children:e.jsx(Z,{children:"Bonus Details"})}),e.jsx(ee,{children:e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[j&&j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"business_id",children:"Business"}),e.jsxs(S,{value:String(r.business_id),onValueChange:s=>t("business_id",s),children:[e.jsx(_,{id:"business_id",children:e.jsx(N,{})}),e.jsx(w,{children:j.map(s=>e.jsx(x,{value:String(s.id),children:s.name},s.id))})]}),e.jsx(m,{message:d.business_id})]}),!o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{children:"Who gets this?"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"all_employees",checked:p==="all",onCheckedChange:s=>{s&&(P("all"),f([]),t("employee_id",null),t("employee_ids",[]))}}),e.jsx(i,{htmlFor:"all_employees",className:"cursor-pointer font-normal",children:"All Employees"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"select_employees",checked:p==="select",onCheckedChange:s=>{s&&P("select")}}),e.jsx(i,{htmlFor:"select_employees",className:"cursor-pointer font-normal",children:"Select Employees"})]}),e.jsx(m,{message:d.employee_id})]}),p==="select"&&!o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Select Employees"}),e.jsxs(re,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(h,{type:"button",variant:"outline",className:"w-full justify-start",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),T?"Searching...":"Search and add employees"]})}),e.jsxs(ne,{className:"w-80 p-0",align:"start",children:[e.jsx("div",{className:"p-2",children:e.jsx(b,{placeholder:"Search employees...",value:u,onChange:s=>E(s.target.value)})}),e.jsx("div",{className:"max-h-60 overflow-auto",children:I.length>0?e.jsx("div",{className:"p-2 space-y-1",children:I.map(s=>e.jsxs(h,{type:"button",variant:"ghost",className:"w-full justify-start",onClick:()=>V(s),disabled:n.includes(s.id),children:[s.name,s.email&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.email,")"]})]},s.id))}):u&&!T&&e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No employees found"})})]})]}),n.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:n.map(s=>{const a=M?.find(c=>c.id===s);return a?e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[e.jsx("span",{children:a.name}),e.jsx(h,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>G(s),children:e.jsx(J,{className:"h-4 w-4"})})]},s):null})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name",children:"Bonus Type"}),e.jsx(b,{id:"name",value:r.name,onChange:s=>t("name",s.target.value),placeholder:"e.g., Performance Bonus, Year-End Bonus, Allowance",required:!0}),e.jsx(m,{message:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"type",children:"Amount Type"}),e.jsxs(S,{value:r.type,onValueChange:s=>t("type",s),children:[e.jsx(_,{id:"type",children:e.jsx(N,{})}),e.jsxs(w,{children:[e.jsx(x,{value:"fixed",children:"Fixed amount"}),e.jsx(x,{value:"percentage",children:"Percentage of salary"})]})]}),e.jsx(m,{message:d.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"amount",children:[r.type==="percentage"?"Percentage":"Amount",r.type==="percentage"&&" (0-100)"]}),e.jsx(b,{id:"amount",type:"number",step:(r.type==="percentage","0.01"),min:"0",max:r.type==="percentage"?"100":void 0,value:r.amount,onChange:s=>t("amount",s.target.value),placeholder:r.type==="percentage"?"e.g., 5":"e.g., 5000",required:!0}),e.jsx(m,{message:d.amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"period",children:"For Period"}),e.jsxs(S,{value:y,onValueChange:H,children:[e.jsx(_,{id:"period",children:e.jsx(N,{})}),e.jsxs(w,{children:[e.jsxs(x,{value:F,children:[new Date().toLocaleDateString("en-US",{month:"long",year:"numeric"})," (Current month)"]}),e.jsxs(x,{value:q,children:[new Date(Date.now()+720*60*60*1e3).toLocaleDateString("en-US",{month:"long",year:"numeric"})," (Next month)"]})]})]}),e.jsx(m,{message:d.period_start}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Period: ",r.period_start&&r.period_end?`${new Date(r.period_start).toLocaleDateString()} - ${new Date(r.period_end).toLocaleDateString()}`:"Select a month"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(se,{id:"description",value:r.description,onChange:s=>t("description",s.target.value),placeholder:"Add any notes about this bonus",rows:3}),e.jsx(m,{message:d.description})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("strong",{children:"Note:"})," This bonus will be included in the payroll for the selected period only."]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{href:"/payroll/bonuses",children:e.jsx(h,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(h,{type:"submit",disabled:k,children:k?"Creating...":"Create Bonus"})]})]})})]})]})]})}export{Ve as default};
